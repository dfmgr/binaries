#!/usr/bin/env bash

APPNAME="$(basename $0)"
SCRIPTDIR="$(dirname "${BASH_SOURCE[0]}")"

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
##@Version     : 010920210727-git
# @Author      : Jason
# @Contact     : casjaysdev@casjay.net
# @File        : hue
# @Created     : Mon, Dec 31, 2019, 00:00 EST
# @License     : WTFPL
# @Copyright   : Copyright (c) CasjaysDev
# @Description : home automation - philips hue script
# @Help        : http://hkionline.net/posts/using-phillips-hue-from-the-command-line
#
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# functions

SCRIPTSFUNCTURL="${SCRIPTSAPPFUNCTURL:-https://github.com/dfmgr/installer/raw/master/functions}"
SCRIPTSFUNCTDIR="${SCRIPTSAPPFUNCTDIR:-/usr/local/share/CasjaysDev/scripts}"
SCRIPTSFUNCTFILE="${SCRIPTSAPPFUNCTFILE:-testing.bash}"

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

if [ -f "$PWD/functions/$SCRIPTSFUNCTFILE" ]; then
  . "$PWD/functions/$SCRIPTSFUNCTFILE"
elif [ -f "$SCRIPTSFUNCTDIR/functions/$SCRIPTSFUNCTFILE" ]; then
  . "$SCRIPTSFUNCTDIR/functions/$SCRIPTSFUNCTFILE"
fi

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# variables
unset hue_api_key hue_device hue_option
DEVICE="$(__hostname2ip ${HUE_HUB_DEVICE:-$2})"
hue_api_key="${HUE_ACCESS_TOKEN}"
hue_device="${DEVICE:-$2}"
hue_option="$1"
hue_group="0"
api_url="${HUE_HUB_API:-http://$hue_device/api/$hue_api_key/groups/$hue_group}"

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
[ ! -z "$hue_api_key" ] || printf_exit "Please set your hue api key"
[ ! -z "$hue_device" ] || printf_exit "Please enter the hostname of your hue hub"
[ ! -z "$hue_option" ] || printf_exit "Please enter the the command you want to send to your hue_api_key"

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# functions
state_on() { curl -LSsq -X PUT "$api_url/action" -d '{"on": true}' &>/dev/null; }
state_off() { curl -LSsq -X PUT "$api_url/action" -d '{"on": false}' &>/dev/null; }

case "$hue_option" in
on | true | 0)
  printf_green "Sending command $hue_option to $hue_device"
  state_on
  ;;
off | false | 1)
  printf_green "Sending command $hue_option to $hue_device"
  state_off
  ;;
#toggle)
#    state_on || state_off
#  ;;
state)
  printf_green "Getting info for group $hue_group from $hue_device"
  curl -LSs "$api_url" | jq
  ;;
esac

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
