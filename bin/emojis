#!/usr/bin/env bash

APPNAME="$(basename $0)"
USER="${SUDO_USER:-${USER}}"

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
##@Version     : 010920210727-git
# @Author      : Jason
# @Contact     : casjaysdev@casjay.net
# @File        : emojis
# @Created     : Wed, Aug 05, 2020, 02:00 EST
# @License     : WTFPL
# @Copyright   : Copyright (c) CasjaysDev
# @Description : show and choose an emoji
#
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Import functions
CASJAYSDEVDIR="${CASJAYSDEVDIR:-/usr/local/share/CasjaysDev/scripts}"
SCRIPTSFUNCTDIR="${CASJAYSDEVDIR:-/usr/local/share/CasjaysDev/scripts}/functions"
SCRIPTSFUNCTFILE="${SCRIPTSAPPFUNCTFILE:-testing.bash}"
SCRIPTSFUNCTURL="${SCRIPTSAPPFUNCTURL:-https://github.com/dfmgr/installer/raw/master/functions}"
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
if [ -f "$PWD/$SCRIPTSFUNCTFILE" ]; then
  . "$PWD/$SCRIPTSFUNCTFILE"
elif [ -f "$SCRIPTSFUNCTDIR/$SCRIPTSFUNCTFILE" ]; then
  . "$SCRIPTSFUNCTDIR/$SCRIPTSFUNCTFILE"
fi
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
systemmgr_install
__options "$@"
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# Emoji list
ARRAY="$(cat ${CASJAYSDEVDIR:-/usr/local/share/CasjaysDev/scripts}/helpers/emojis/array)"
LIST="$(cat ${CASJAYSDEVDIR:-/usr/local/share/CasjaysDev/scripts}/helpers/emojis/list)"

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

dmenu_emojis() {
  xclip -h 2>/dev/null || exit 1
  chosen=$(cut -d ';' -f1 $CASJAYSDEVDIR/helpers/emojis/emojis | dmenu -i -l 20 | sed "s/ .*//")

  [ "$chosen" != "" ] || exit

  if [ -n "$1" ]; then
    #xdotool key Shift+Insert
    xdotool key --clearmodifiers ctrl+shift+v
  else
    echo "$chosen" | tr -d '\n' | xclip -selection clipboard
    notify-send "'$chosen' copied to clipboard." &
    xdotool key --clearmodifiers ctrl+shift+v
  fi
}

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

case "$1" in
update | -update | --update)
  mkdir -p "$HOME/.local/bin"
  curl -LSs https://raw.githubusercontent.com/mrowa44/emojify/master/emojify -o "$HOME/.local/bin/emojify" 2>/dev/null && chmod +x "$HOME/.local/bin/emojify"
  [ $? -eq 0 ] && printf_green "Update Successful" || printf_red "Update Failed"
  if (sudo -vn && sudo -ln) 2>&1 | grep -v 'may not' >/dev/null; then
    sudo mv -f "$HOME/.local/bin/emojify" /usr/local/bin/emojify
    [ $? -eq 0 ] && printf_green "System Update Successful" || printf_red "System Update Failed"
  fi
  ;;

dmenu)
  __cmd_exists dmenu && dmenu_emojis "$@" || printf_exit "dmenu doesn't seem to be installed"
  ;;

search | -s* | --s*)
  shift 1
  var="$1"
  emojify --list | grep "$var"
  unset var
  ;;

print | -p* | --p* | -e* | --e* | echo | text)
  shift 1
  args="$@"
  var="$(printf_green $args)"
  emojify "$var"
  unset var
  ;;

list | -l* | --l*)
  var="($(emojify -l | awk '{print $2}' 2>/dev/null | sed 's# ##g' | tr '\n' ' '))"
  echo -e ""
  echo -e $var | sed 's#(- emojify emojis: ##g'
  printf_red "List of available emojis - Just copy and use"
  unset var
  ;;

*)
  __help
  ;;

esac

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# end
