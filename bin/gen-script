#!/usr/bin/env bash

APPNAME="gen-script"
USER="${SUDO_USER:-${USER}}"
HOME="${USER_HOME:-${HOME}}"

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
##@Version       : 020120210023-git
# @Author        : Jason
# @Contact       : jason@casjaysdev.com
# @License       : WTFPL
# @Copyright     : Copyright (c) 2021, Casjays Developments
# @Created       : Monday Feb 01, 2021 00:23:58 EST
# @File          : gen-script
# @Description   : create scripts
# @TODO          :
# @Other         :
#
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Set functions
CASJAYSDEVDIR="${CASJAYSDEVDIR:-/usr/local/share/CasjaysDev/scripts}"
SCRIPTSFUNCTURL="${SCRIPTSAPPFUNCTURL:-https://github.com/casjay-dotfiles/scripts/raw/master/functions}"
SCRIPTSFUNCTDIR="${SCRIPTSAPPFUNCTDIR:-$CASJAYSDEVDIR/functions}"
SCRIPTSFUNCTFILE="${SCRIPTSAPPFUNCTFILE:-testing.bash}"

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
if [ -f "$SCRIPTSFUNCTDIR/$SCRIPTSFUNCTFILE" ]; then
  . "$SCRIPTSFUNCTDIR/$SCRIPTSFUNCTFILE"
elif [ -f "$HOME/.local/share/CasjaysDev/functions/$SCRIPTSFUNCTFILE" ]; then
  . "$HOME/.local/share/CasjaysDev/functions/$SCRIPTSFUNCTFILE"
else
  curl -LSs "$SCRIPTSFUNCTURL/$SCRIPTSFUNCTFILE" -o "/tmp/$SCRIPTSFUNCTFILE" || exit 1
  . "/tmp/$SCRIPTSFUNCTFILE"
fi
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
user_install
__options "$@"
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# defaults
GEN_SCRIPTS_YEAR="$(date +%Y)"
GEN_SCRIPTS_EMAIL="${USER}"
GEN_SCRIPTS_AUTHOR="${USER}"
GEN_SCRIPTS_COMPANY="${USER}"
GEN_SCRIPTS_VERSION="%m%d%Y%H%M-git"
GEN_SCRIPTS_DEFREADME="README.md"
GEN_SCRIPTS_DEFLICENSE="WTFPL"
GEN_SCRIPTS_DATEFMT="%A, %b %d, %Y %H:%M %Z"
if [ -d "$HOME/.config/$APPNAME/files" ]; then
  GEN_SCRIPTS_TEMPLATE_DIR="$HOME/.config/$APPNAME/files"
else
  GEN_SCRIPTS_TEMPLATE_DIR="${GEN_SCRIPTS_TEMPLATE_DIR:-$CASJAYSDEVDIR/templates/scripts}"
fi
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Application functions
__date() { date +"${1:-$DATEFMT}"; }
__filename() { basename "$1"; }

__config() {
  cat <<EOF
GEN_SCRIPTS_EMAIL="${GEN_SCRIPTS_EMAIL}"
GEN_SCRIPTS_AUTHOR="${GEN_SCRIPTS_AUTHOR}"
GEN_SCRIPTS_COMPANY="${GEN_SCRIPTS_COMPANY}"
GEN_SCRIPTS_VERSION="%m%d%Y%H%M-git"
GEN_SCRIPTS_DEFREADME="README.md"
GEN_SCRIPTS_DEFLICENSE="WTFPL"
GEN_SCRIPTS_DATEFMT="%A, %b %d, %Y %H:%M %Z"
GEN_SCRIPTS_TEMPLATE_DIR="${GEN_SCRIPTS_TEMPLATE_DIR}"
EOF
}

__copy_templates() {
  __mkd "$HOME/.config/$APPNAME/files"
  __cp_rf "$CASJAYSDEVDIR/templates/scripts/." "$HOME/.config/$APPNAME/files/"
}

__makefile() {
  local temp=${1:?}
  local new=${2:-new-script}
  __cp_rf "$temp" "$new"
  __edit_header "$new"
}

__edit_header() {
  local new="${1:-}"
  sed -i 's#REPLACE_FILENAME#'"$(__filename "$new")"'#g' "$new"
  sed -i 's#REPLACE_VERSION#'"$(__date "${GEN_SCRIPTS_VERSION}")"'#g' "$new"
  sed -i 's#REPLACE_DATE#'"$(__date "${GEN_SCRIPTS_DATEFMT}")"'#g' "$new"
  sed -i 's#REPLACE_LICENSE#'${GEN_SCRIPTS_DEFLICENSE}'#g' "$new"
  sed -i 's#REPLACE_AUTHOR#'${GEN_SCRIPTS_AUTHOR}'#g' "$new"
  sed -i 's#REPLACE_EMAIL#'${GEN_SCRIPTS_EMAIL}'#g' "$new"
  sed -i 's#REPLACE_YEAR#'${GEN_SCRIPTS_YEAR}'#g' "$new"
}

__gen_header() {
  local new="${1:-}"
  cat <<EOF

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
##@Version       : $(__date "${GEN_SCRIPTS_VERSION}")
# @Author        : ${GEN_SCRIPTS_AUTHOR}
# @Contact       : ${GEN_SCRIPTS_EMAIL}
# @License       : ${GEN_SCRIPTS_DEFLICENSE}
# @Copyright     : Copyright (c) ${GEN_SCRIPTS_YEAR}, ${GEN_SCRIPTS_AUTHOR}
# @Created       : $(__date "${GEN_SCRIPTS_DATEFMT}")
# @File          : $(__filename ${new:-sample})
# @Description   :
# @TODO          :
# @Other         :
# @Resource      :
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

EOF
}

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Main application
case "$1" in
config)
  shift 1
  __config
  exit
  ;;

header)
  shift 1
  __gen_header "$1"
  exit
  ;;

shell)
  shift 1
  case "$1" in
  sh)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/shell/template.sh"
    dest="$1"
    ;;

  bash)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/shell/template.bash"
    dest="$1"
    ;;
  esac
  ;;

installers)
  shift 1
  case "$1" in
  devenvmgr)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/installers/$1.sh"
    dest="$1"
    ;;

  dfmgr)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/installers/$1.sh"
    dest="$1"
    ;;

  dockermgr)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/installers/$1.sh"
    dest="$1"
    ;;

  fontmgr)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/installers/$1.sh"
    dest="$1"
    ;;

  iconmgr)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/installers/$1.sh"
    dest="$1"
    ;;

  personal)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/installers/$1.sh"
    dest="$1"
    ;;

  systemmgr)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/installers/$1.sh"
    dest="$1"
    ;;

  thememgr)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/installers/$1.sh"
    dest="$1"
    ;;

  wallpapermgr)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/installers/$1.sh"
    dest="$1"
    ;;
  esac
  ;;

os)
  shift 1
  case "$1" in
  arch)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/installers/os-$1.sh"
    dest="$1"
    ;;

  centos)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/installers/os-$1.sh"
    dest="$1"
    ;;

  debian)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/installers/os-$1.sh"
    dest="$1"
    ;;

  fedora)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/installers/os-$1.sh"
    dest="$1"
    ;;

  macos)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/installers/os-$1.sh"
    dest="$1"
    ;;

  void)
    shift 1
    template="${GEN_SCRIPTS_TEMPLATE_DIR}/installers/os-$1.sh"
    dest="$1"
    ;;
  esac
  ;;

esac

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
__makefile "$template" "$dest"

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
exit $?
# end
